<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Maintenance App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .box {
            border: 1px solid #ccc;
            padding: 20px;
            width: 300px;
            background-color: #f9f9f9;
            margin-bottom: 20px;
        }
        .box ul {
            list-style-type: none;
            padding: 0;
        }
        .box li {
            padding: 5px 0;
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }
        .form-container {
            margin-top: 20px;
        }
        .form-container input {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>Sensors Calibration</h1>
    <div class="box">
        <ul id="sensorList">
            <!-- Sensor list will be populated dynamically -->
        </ul>
        <button id="addSensorButton">Add Sensor</button>
        <div id="addSensorForm" class="form-container" style="display: none;">
            <input type="text" id="sensorNameInput" placeholder="Enter sensor name">
            <button id="submitSensorButton">Submit</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchSensors();

            const addSensorButton = document.getElementById('addSensorButton');
            const addSensorForm = document.getElementById('addSensorForm');
            const submitSensorButton = document.getElementById('submitSensorButton');

            addSensorButton.addEventListener('click', () => {
                addSensorForm.style.display = 'block';
            });

            submitSensorButton.addEventListener('click', () => {
                const sensorNameInput = document.getElementById('sensorNameInput');
                const sensorName = sensorNameInput.value.trim();

                if (sensorName) {
                    addSensor(sensorName);
                    sensorNameInput.value = ''; // Clear the input field
                    addSensorForm.style.display = 'none'; // Hide the form
                } else {
                    alert('Please enter a sensor name.');
                }
            });
        });

        function fetchSensors() {
            fetch('http://localhost:3000/sensors')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to fetch sensors from the database');
                    }
                })
                .then(sensors => {
                    const sensorList = document.getElementById('sensorList');
                    sensorList.innerHTML = ''; // Clear existing list

                    sensors.forEach(sensor => {
                        const sensorItem = document.createElement('li');
                        sensorItem.textContent = sensor.sensor_name; // Display sensor name

                        // Add click event to display the Test Report box
                        sensorItem.addEventListener('click', () => {
                            displayTestReport(sensor.sensor_name);
                        });

                        // Create an "Edit" button
                        const editButton = document.createElement('button');
                        editButton.textContent = 'Edit';
                        editButton.style.marginLeft = '10px';
                        editButton.addEventListener('click', () => {
                            const newSensorName = prompt('Enter the new sensor name:', sensor.sensor_name);
                            if (newSensorName && newSensorName.trim() !== '') {
                                editSensor(sensor.id, newSensorName.trim());
                            } else {
                                alert('Sensor name not edited.');
                            }
                        });

                        // Create a "Remove" button
                        const removeButton = document.createElement('button');
                        removeButton.textContent = 'Remove';
                        removeButton.style.marginLeft = '10px';
                        removeButton.addEventListener('click', () => {
                            if (confirm(`Are you sure you want to remove "${sensor.sensor_name}"?`)) {
                                removeSensor(sensor.id); // Pass the sensor ID
                            }
                        });

                        // Append buttons in the desired order
                        sensorItem.appendChild(editButton);
                        sensorItem.appendChild(removeButton);
                        sensorList.appendChild(sensorItem);
                    });
                })
                .catch(error => {
                    console.error(error);
                    alert('Error fetching sensors from the database');
                });
        }

        function addSensor(sensorName) {
            fetch('http://localhost:3000/sensors', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ sensor_name: sensorName }),
            })
            .then(response => {
                if (response.ok) {
                    fetchSensors(); // Refresh the sensor list
                } else {
                    throw new Error('Failed to add sensor to the database');
                }
            })
            .catch(error => {
                console.error(error);
                alert('Error adding sensor to the database');
            });
        }

        function removeSensor(sensorId) {
            fetch(`http://localhost:3000/sensors/${sensorId}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (response.ok) {
                    fetchSensors(); // Refresh the sensor list
                } else {
                    throw new Error('Failed to remove sensor from the database');
                }
            })
            .catch(error => {
                console.error(error);
                alert('Error removing sensor from the database');
            });
        }

        function editSensor(sensorId, newSensorName) {
            fetch(`http://localhost:3000/sensors/${sensorId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ sensor_name: newSensorName }),
            })
            .then(response => {
                if (response.ok) {
                    fetchSensors(); // Refresh the sensor list
                } else {
                    throw new Error('Failed to edit sensor in the database');
                }
            })
            .catch(error => {
                console.error(error);
                alert('Error editing sensor in the database');
            });
        }

        function displayTestReport(sensorName) {
            // Check if a Test Report box already exists and remove it
            const existingReportBox = document.getElementById('testReportBox');
            if (existingReportBox) {
                existingReportBox.remove();
            }

            // Create the Test Report box
            const testReportBox = document.createElement('div');
            testReportBox.id = 'testReportBox';
            testReportBox.className = 'box';
            testReportBox.style.width = '1800px'; // Set the width to 4 times the original (300px * 4)
            testReportBox.innerHTML = `
                <h2>Test Report: ${sensorName}</h2>
                <div class="box">Test Equipment</div>
                <div class="box">Sensor Calibration Sheet 1 (a)</div>
                <div class="box">Sensor Calibration Sheet 1 (b)</div>
            `;

            // Append the Test Report box to the body
            document.body.appendChild(testReportBox);
        }
    </script>
</body>
</html>